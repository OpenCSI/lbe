{# Include the hidden fields #}
{% for hidden in form.hidden_fields %}
{{ hidden }}
{% endfor %}
{# Include the visible fields #}
<script type="text/javascript">
{% if multivalue %}
	function addField(attribute,value)
	{
		$('.'+attribute).append(value + '<br>');
	}
{% endif %}
	function clone(obj) {
    // Handle the 3 simple types, and null or undefined
    if (null == obj || "object" != typeof obj) return obj;

    // Handle Object
    if (obj instanceof Object) {
        var copy = {};
        for (var attr in obj) {
            if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);
        }
        return copy;
    }

    throw new Error("Unable to copy obj! Its type isn't supported.");
	}

function multivalue(field,key,values)
{
	tab = values.split("ï¿½");// [FIXME]: check for better value coded.
	i=0;
	fields = '';
	for (num in tab)
	{
		if (i==0)
			$('#id_'+key).val(tab[num])
		else
		{
			if (tab[num] != '')
			{
				$('.'+key).append($('#id_'+key).clone().val(tab[num]))
				$('.'+key).append('<br>')
			}
		}
		i++;
	}
}
</script>
<table class='table table-condensed'>
{% for field in form.visible_fields %}
    <tr>
        <th> {{ field.label }} </th>
        <td> {{ field }}{% for mv in multivalue %}{% if mv == field.name %} <a class="btn btn-primary" onClick="addField('{{mv}}','{% filter force_escape %}{% spaceless %}{{field}}{% endspaceless %}{% endfilter %}');">+</a>
			<div class="{{mv}}"></div> <script>multivalue("{% filter force_escape %}{% spaceless %}{{field}}{% endspaceless %}{% endfilter %}","{{mv}}","{{field.data|default_if_none:""}}");</script> {% endif %} {% endfor %}
            {% for error in field.errors %} <div><span class='label label-important'>{{ error }}</span></div> {% endfor %}
        </td>
    </tr>
{% endfor %}
    <tr>
        <td colspan=2 style='text-align: center;'><input type='submit' name='Submit' class='btn'></td>
    </tr>
</table>
