{% extends "index.html" %}
{% load url from future %}
{% block content %}
    <script type="text/javascript" xmlns="http://www.w3.org/1999/html">
        i = 0;
        function addField(attribute, value) {
            value = value.replace('id="id_' + attribute + '"', 'id=' + attribute + '_' + i)
            $('.' + attribute).append('<span style="display:block;" class="span_' + attribute + '_' + i + '">' + value + ' <a href="#" class="btn btn-inverse" id="btn_' + attribute + '_' + i + '" onClick="remove(\'' + attribute + '_' + i + '\');return false">-</a></span>')
            i++
        }

        function remove(key) {
            $('#' + key).val('')
            $('#' + key).hide()
            $('#btn_' + key).hide()
            $('.span_' + key).hide()
        }

        function clone(obj) {
            // Handle the 3 simple types, and null or undefined
            if (null == obj || "object" != typeof obj) return obj;

            // Handle Object
            if (obj instanceof Object) {
                var copy = {};
                for (var attr in obj) {
                    if (obj.hasOwnProperty(attr)) copy[attr] = clone(obj[attr]);
                }
                return copy;
            }

            throw new Error("Unable to copy obj! Its type isn't supported.");
        }

        function multivalue(field, key, values) {
            tab = values.split("ï¿½");// [FIXME]: check for better value coded.
            fields = '';
            for (num in tab) {
                if (i == 0)
                    $('#id_' + key).val(tab[num])
                else {
                    if (tab[num] != '') {
                        $add = $('#id_' + key).clone()
                        $add.attr("id", key + '_' + i)
                        $add.val(tab[num])
                        $('.' + key).append($add)
                        $('.' + key).append(' <a href="#" class="btn btn-inverse" id="btn_' + key + '_' + i
                                + '" onClick="remove(\'' + key + '_' + i + '\');return false">-</a>')
                        $('.' + key).append('<br>')
                    }
                }
                i++;
            }
        }
    </script>

<h3>{{ groupName }}</h3>
    {% for hidden in form.hidden_fields %}
        {{ hidden }}
    {% endfor %}
    <form method="POST">
    {% csrf_token %}
    <table class="table">
        {% for field in form.visible_fields %}
    <tr>
        <th>Employee</th>
        <td>{{ field }}

            <a class="btn btn-primary"
               onClick="addField('{{ field.name }}','{% filter force_escape %}{% spaceless %}{{ field }}{% endspaceless %}{% endfilter %}');">+</a>
            <div class="uniqueMember"></div>
            <script>multivalue("{% filter force_escape %}{% spaceless %}{{field}}{% endspaceless %}{% endfilter %}", "uniqueMember", "{{field.data|default_if_none:""}}");</script>
            {% for error in field.errors %}
                <div><span class='label label-important'>{{ error }}</span></div> {% endfor %}
        </td>
    </tr>
        {% endfor %}
    </table>
        <center><input type="submit" class="btn"/></center>
    </form>
{% endblock %}